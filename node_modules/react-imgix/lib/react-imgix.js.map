{"version":3,"sources":["../src/react-imgix.jsx"],"names":["PACKAGE_VERSION","NODE_ENV","process","env","buildKey","idx","defaultImgixParams","auto","defaultAttributeMap","src","srcSet","sizes","noop","COMMON_PROP_TYPES","className","PropTypes","string","onMounted","func","htmlAttributes","object","SHARED_IMGIX_AND_SOURCE_PROP_TYPES","disableQualityByDPR","bool","disableSrcSet","disableLibraryParam","imgixParams","width","number","height","isRequired","aspectRatioIsValid","aspectRatio","test","setParentRef","parentRef","el","current","buildSrcSetPairWithFixedHeight","url","targetWidth","fixedHeight","_","buildSrcSetPairWithTargetWidth","_1","_2","buildDprSrcWithQuality","quality","dpr","buildDprSrcWithoutQuality","buildDprSrcWithQualityByDpr","buildSrc","inputSrc","fixedSize","rawSrc","params","srcOptions","ixlib","q","urlParams","constructedUrl","srcFn","len","DPR_QUALITY_VALUES","length","i","slice","w","ar","showARWarning","targetWidths","config","warnings","invalidARFormat","console","warn","props","ReactImgix","imgRef","type","sizesAttribute","_inPicture","attributeConfig","childProps","undefined","ref","Component","displayName","PictureImpl","pictureRef","children","_children","React","Children","map","child","cloneElement","key","imgIdx","findIndex","c","ReactImgixWrapped","fallbackImage","push","splice","any","SourceImpl","sourceRef","ShouldComponentUpdateHOC","Picture","Source"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,eAAe,UAArB;AACA,IAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYF,QAA7B;;AAEA,IAAMG,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD;AAAA,+BAAwBA,GAAxB;AAAA,CAAjB;;AAEA,IAAMC,kBAAkB,GAAG;AACzBC,EAAAA,IAAI,EAAE,CAAC,QAAD;AADmB,CAA3B;AAIA,IAAMC,mBAAmB,GAAG;AAC1BC,EAAAA,GAAG,EAAE,KADqB;AAE1BC,EAAAA,MAAM,EAAE,QAFkB;AAG1BC,EAAAA,KAAK,EAAE;AAHmB,CAA5B;;AAMA,IAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM,CAAE,CAArB;;AAEA,IAAMC,iBAAiB,GAAG;AACxBC,EAAAA,SAAS,EAAEC,mBAAUC,MADG;AAExBC,EAAAA,SAAS,EAAEF,mBAAUG,IAFG;AAGxBC,EAAAA,cAAc,EAAEJ,mBAAUK;AAHF,CAA1B;;AAMA,IAAMC,kCAAkC,GAAG,SACzC,EADyC,EAEzCR,iBAFyC,EAGzC;AACES,EAAAA,mBAAmB,EAAEP,mBAAUQ,IADjC;AAEEC,EAAAA,aAAa,EAAET,mBAAUQ,IAF3B;AAGEE,EAAAA,mBAAmB,EAAEV,mBAAUQ,IAHjC;AAIEG,EAAAA,WAAW,EAAEX,mBAAUK,MAJzB;AAKET,EAAAA,KAAK,EAAEI,mBAAUC,MALnB;AAMEW,EAAAA,KAAK,EAAEZ,mBAAUa,MANnB;AAOEC,EAAAA,MAAM,EAAEd,mBAAUa,MAPpB;AAQEnB,EAAAA,GAAG,EAAEM,mBAAUC,MAAV,CAAiBc;AARxB,CAHyC,CAA3C;AAeA;AACA;AACA;;;AACA,SAASC,kBAAT,CAA4BC,WAA5B,EAAyC;AACvC,MAAI,OAAOA,WAAP,KAAuB,QAA3B,EAAqC;AACnC,WAAO,KAAP;AACD;;AAED,SAAO,4BAA4BC,IAA5B,CAAiCD,WAAjC,CAAP;AACD;;AAED,IAAME,YAAY,GAAG,SAAfA,YAAe,CAACC,SAAD,EAAYC,EAAZ,EAAmB;AACtC,MAAI,CAACD,SAAL,EAAgB;AACd;AACD,GAHqC,CAKtC;;;AACA,MAAI,OAAOA,SAAP,KAAqB,UAAzB,EAAqC;AACnCA,IAAAA,SAAS,CAACC,EAAD,CAAT;AACD,GAFD,MAEO;AACLD,IAAAA,SAAS,CAACE,OAAV,GAAoBD,EAApB;AACD;AACF,CAXD;;AAaA,IAAME,8BAA8B,GAAG,SAAjCA,8BAAiC,CAACC,GAAD,EAAMC,WAAN,EAAmBC,WAAnB,EAAgCC,CAAhC;AAAA,SACrCH,GAAG,GAAG,KAAN,GAAcE,WAAd,GAA4B,KAA5B,GAAoCD,WAApC,GAAkD,GAAlD,GAAwDA,WAAxD,GAAsE,GADjC;AAAA,CAAvC;;AAGA,IAAMG,8BAA8B,GAAG,SAAjCA,8BAAiC,CAACJ,GAAD,EAAMC,WAAN,EAAmBI,EAAnB,EAAuBC,EAAvB;AAAA,SACrCN,GAAG,GAAG,KAAN,GAAcC,WAAd,GAA4B,GAA5B,GAAkCA,WAAlC,GAAgD,GADX;AAAA,CAAvC;;AAGA,IAAMM,sBAAsB,GAAG,SAAzBA,sBAAyB,CAACP,GAAD,EAAMQ,OAAN,EAAeC,GAAf;AAAA,SAC7BT,GAAG,GAAG,KAAN,GAAcQ,OAAd,GAAwB,OAAxB,GAAkCC,GAAlC,GAAwC,GAAxC,GAA8CA,GAA9C,GAAoD,GADvB;AAAA,CAA/B;;AAGA,IAAMC,yBAAyB,GAAG,SAA5BA,yBAA4B,CAACV,GAAD,EAAMG,CAAN,EAASM,GAAT;AAAA,SAChCT,GAAG,GAAG,OAAN,GAAgBS,GAAhB,GAAsB,GAAtB,GAA4BA,GAA5B,GAAkC,GADF;AAAA,CAAlC;;AAGA,IAAME,2BAA2B,GAAG,SAA9BA,2BAA8B,CAACX,GAAD,EAAMQ,OAAN,EAAeC,GAAf;AAAA,SAClCT,GAAG,GAAG,KAAN,GAAcQ,OAAd,GAAwB,OAAxB,GAAkCC,GAAlC,GAAwC,GAAxC,GAA8CA,GAA9C,GAAoD,GADlB;AAAA,CAApC;AAGA;AACA;AACA;;;AACA,SAASG,QAAT,OAQG;AAAA,MAPIC,QAOJ,QAPD3C,GAOC;AAAA,MANDkB,KAMC,QANDA,KAMC;AAAA,MALDE,MAKC,QALDA,MAKC;AAAA,MAJDJ,mBAIC,QAJDA,mBAIC;AAAA,MAHDD,aAGC,QAHDA,aAGC;AAAA,MAFDE,WAEC,QAFDA,WAEC;AAAA,MADDJ,mBACC,QADDA,mBACC;AACD,MAAM+B,SAAS,GAAG1B,KAAK,IAAI,IAAT,IAAiBE,MAAM,IAAI,IAA7C;;AADC,4BAGwB,kCAAmBuB,QAAnB,CAHxB;AAAA;AAAA,MAGME,MAHN;AAAA,MAGcC,MAHd;;AAKD,MAAMC,UAAU,GAAG,SACjB,EADiB,EAEjBD,MAFiB,EAGjB7B,WAHiB,EAIjBD,mBAAmB,GAAG,EAAH,GAAQ;AAAEgC,IAAAA,KAAK,kBAAWzD,eAAX;AAAP,GAJV,EAKjBqD,SAAS,IAAIxB,MAAb,GAAsB;AAAEA,IAAAA,MAAM,EAANA;AAAF,GAAtB,GAAmC,EALlB,EAMjBwB,SAAS,IAAI1B,KAAb,GAAqB;AAAEA,IAAAA,KAAK,EAALA;AAAF,GAArB,GAAiC,EANhB,CAAnB;;AASA,MAAMlB,GAAG,GAAG,2BAAa6C,MAAb,EAAqBE,UAArB,CAAZ;AAEA,MAAI9C,MAAJ;;AAEA,MAAIc,aAAJ,EAAmB;AACjBd,IAAAA,MAAM,GAAGD,GAAT;AACD,GAFD,MAEO;AACL,QAAI4C,SAAJ,EAAe;AAAA,UACLK,CADK,GACeF,UADf,CACLE,CADK;AAAA,UACCC,SADD,4BACeH,UADf;;AAEb,UAAMI,cAAc,GAAG,2BAAaN,MAAb,EAAqBK,SAArB,CAAvB;AAEA,UAAIE,KAAK,GAAGX,2BAAZ;;AACA,UAAIQ,CAAJ,EAAO;AACLG,QAAAA,KAAK,GAAGf,sBAAR;AACD,OAFD,MAEO,IAAIxB,mBAAJ,EAAyB;AAC9BuC,QAAAA,KAAK,GAAGZ,yBAAR;AACD;;AAEDvC,MAAAA,MAAM,GAAG,EAAT;AACA,UAAMoD,GAAG,GAAGC,8BAAmBC,MAA/B;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,GAApB,EAAyBG,CAAC,EAA1B,EAA8B;AAC5B,YAAMlB,OAAO,GAAGgB,8BAAmBE,CAAnB,CAAhB;AACAvD,QAAAA,MAAM,IAAImD,KAAK,CAACD,cAAD,EAAiBF,CAAC,IAAIX,OAAtB,EAA+BkB,CAAC,GAAG,CAAnC,CAAL,GAA6C,IAAvD;AACD;;AACDvD,MAAAA,MAAM,GAAGA,MAAM,CAACwD,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAT;AACD,KAlBD,MAkBO;AAAA,UACGvC,MADH,GACsC6B,UADtC,CACG7B,KADH;AAAA,UACUwC,CADV,GACsCX,UADtC,CACUW,CADV;AAAA,UACatC,OADb,GACsC2B,UADtC,CACa3B,MADb;AAAA,UACwB8B,UADxB,4BACsCH,UADtC;;AAEL,UAAMI,eAAc,GAAG,2BAAaN,MAAb,EAAqBK,UAArB,CAAvB;;AAEA,UAAM3B,WAAW,GAAGN,WAAW,CAAC0C,EAAhC;AACA,UAAIC,aAAa,GACfrC,WAAW,IAAI,IAAf,IAAuBD,kBAAkB,CAACC,WAAD,CAAlB,KAAoC,KAD7D;AAGA,UAAI6B,MAAK,GAAGlB,8BAAZ;;AACA,UAAId,OAAJ,EAAY;AACVgC,QAAAA,MAAK,GAAGvB,8BAAR;AACD;;AAED5B,MAAAA,MAAM,GAAG,EAAT;AACA,UAAMoD,IAAG,GAAGQ,sBAAaN,MAAzB;;AACA,WAAK,IAAIC,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGH,IAApB,EAAyBG,GAAC,EAA1B,EAA8B;AAC5B,YAAMzB,WAAW,GAAG8B,sBAAaL,GAAb,CAApB;AACAvD,QAAAA,MAAM,IAAImD,MAAK,CAACD,eAAD,EAAiBpB,WAAjB,EAA8BX,OAA9B,CAAL,GAA6C,IAAvD;AACD;;AACDnB,MAAAA,MAAM,GAAGA,MAAM,CAACwD,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAT;;AAEA,UACEjE,QAAQ,KAAK,YAAb,IACAoE,aADA,IAEAE,eAAOC,QAAP,CAAgBC,eAHlB,EAIE;AACAC,QAAAA,OAAO,CAACC,IAAR,8CACuC3C,WADvC;AAGD;AACF;AACF;;AAED,SAAO;AACLvB,IAAAA,GAAG,EAAHA,GADK;AAELC,IAAAA,MAAM,EAANA;AAFK,GAAP;AAID;AAED;AACA;AACA;;;AACA,SAASgB,WAAT,CAAqBkD,KAArB,EAA4B;AAC1B,MAAMrB,MAAM,GAAG,SAAc,EAAd,EAAkBjD,kBAAlB,EAAsCsE,KAAK,CAAClD,WAA5C,CAAf;;AACA,SAAO,SAAc,EAAd,EAAkB6B,MAAlB,CAAP;AACD;AAED;AACA;AACA;;;IACMsB,U;;;;;AAOJ,sBAAYD,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;AACA,UAAKE,MAAL,GAAc,IAAd;AAFiB;AAGlB;;;;wCAEmB;AAClB,WAAKF,KAAL,CAAW3D,SAAX,CAAqB,KAAK6D,MAA1B;AACD;;;6BAEQ;AAAA;AAAA;;AAAA,wBACwC,KAAKF,KAD7C;AAAA,UACCpD,aADD,eACCA,aADD;AAAA,UACgBuD,IADhB,eACgBA,IADhB;AAAA,UACsBpD,KADtB,eACsBA,KADtB;AAAA,UAC6BE,MAD7B,eAC6BA,MAD7B,EAGP;;AACA,UAAI5B,QAAQ,KAAK,YAAb,IAA6BsE,eAAOC,QAAP,CAAgBQ,cAAjD,EAAiE;AAC/D,YACE,KAAKJ,KAAL,CAAWjD,KAAX,IAAoB,IAApB,IACA,KAAKiD,KAAL,CAAW/C,MAAX,IAAqB,IADrB,IAEA,KAAK+C,KAAL,CAAWjE,KAAX,IAAoB,IAFpB,IAGA,CAAC,KAAKiE,KAAL,CAAWK,UAJd,EAKE;AACAP,UAAAA,OAAO,CAACC,IAAR,CACE,sEADF;AAGD;AACF;;AAfM,sBAiBiBxB,QAAQ,CAC9B,SAAc,EAAd,EAAkB,KAAKyB,KAAvB,EAA8B;AAC5BG,QAAAA,IAAI,EAAE,KADsB;AAE5BrD,QAAAA,WAAW,EAAEA,WAAW,CAAC,KAAKkD,KAAN;AAFI,OAA9B,CAD8B,CAjBzB;AAAA,UAiBCnE,GAjBD,aAiBCA,GAjBD;AAAA,UAiBMC,MAjBN,aAiBMA,MAjBN;;AAwBP,UAAMwE,eAAe,GAAG,SACtB,EADsB,EAEtB1E,mBAFsB,EAGtB,KAAKoE,KAAL,CAAWM,eAHW,CAAxB;;AAKA,UAAMC,UAAU,GAAG,SAAc,EAAd,EAAkB,KAAKP,KAAL,CAAWzD,cAA7B,8CAChB+D,eAAe,CAACvE,KADA,EACQ,KAAKiE,KAAL,CAAWjE,KADnB,2CAEN,KAAKiE,KAAL,CAAW9D,SAFL,uCAGVa,KAAK,IAAI,CAAT,GAAa,IAAb,GAAoBA,KAHV,wCAITE,MAAM,IAAI,CAAV,GAAc,IAAd,GAAqBA,MAJZ,8BAKhBqD,eAAe,CAACzE,GALA,EAKMA,GALN,qCAMZ,aAAC2B,EAAD,EAAQ;AACX,QAAA,MAAI,CAAC0C,MAAL,GAAc1C,EAAd;;AACA,YACE,MAAI,CAACwC,KAAL,CAAWzD,cAAX,KAA8BiE,SAA9B,IACA,SAAS,MAAI,CAACR,KAAL,CAAWzD,cAFtB,EAGE;AACAe,UAAAA,YAAY,CAAC,MAAI,CAAC0C,KAAL,CAAWzD,cAAX,CAA0BkE,GAA3B,EAAgC,MAAI,CAACP,MAArC,CAAZ;AACD;AACF,OAdgB,cAAnB;;AAgBA,UAAI,CAACtD,aAAL,EAAoB;AAClB2D,QAAAA,UAAU,CAACD,eAAe,CAACxE,MAAjB,CAAV,GAAqCA,MAArC;AACD;;AAED,0BAAO,oCAASyE,UAAT,CAAP;AACD;;;;EAlEsBG,gB;;;;gBAAnBT,U,eACe,SAAc,EAAd,EAAkBxD,kCAAlB,C;;gBADfwD,U,kBAEkB;AACpBrD,EAAAA,aAAa,EAAE,KADK;AAEpBP,EAAAA,SAAS,EAAEL;AAFS,C;;AAkExBiE,UAAU,CAACU,WAAX,GAAyB,YAAzB;AAEA;AACA;AACA;;IACMC,W;;;;;AAQJ,uBAAYZ,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,gCAAMA,KAAN;AACA,WAAKa,UAAL,GAAkB,IAAlB;AAFiB;AAGlB;;;;wCAEmB;AAClB,WAAKb,KAAL,CAAW3D,SAAX,CAAqB,KAAKwE,UAA1B;AACD;;;6BAEQ;AAAA;;AAAA,UACCC,QADD,GACc,KAAKd,KADnB,CACCc,QADD,EAGP;;AACA,UAAIC,SAAS,GACXC,eAAMC,QAAN,CAAeC,GAAf,CAAmBJ,QAAnB,EAA6B,UAACK,KAAD,EAAQ1F,GAAR;AAAA,4BAC3BuF,eAAMI,YAAN,CAAmBD,KAAnB,EAA0B;AACxBE,UAAAA,GAAG,EAAE7F,QAAQ,CAACC,GAAD,CADW;AAExB4E,UAAAA,UAAU,EAAE;AAFY,SAA1B,CAD2B;AAAA,OAA7B,KAKK,EANP;AAQA;AACJ;AACA;AACA;AACA;AAEI;;;AACA,UAAIiB,MAAM,GAAGP,SAAS,CAACQ,SAAV,CACX,UAACC,CAAD;AAAA,eACEA,CAAC,CAACrB,IAAF,KAAW,KAAX,IACAqB,CAAC,CAACrB,IAAF,KAAWF,UADX,IAEAuB,CAAC,CAACrB,IAAF,KAAWsB,iBAHb;AAAA,OADW,CAAb;;AAOA,UAAIH,MAAM,KAAK,CAAC,CAAZ,IAAiB3B,eAAOC,QAAP,CAAgB8B,aAArC,EAAoD;AAClD5B,QAAAA,OAAO,CAACC,IAAR,CACE,6KADF;AAGD,OAJD,MAIO,IAAIuB,MAAM,KAAKP,SAAS,CAAC3B,MAAV,GAAmB,CAAlC,EAAqC;AAC1C;AACA2B,QAAAA,SAAS,CAACY,IAAV,CAAeZ,SAAS,CAACa,MAAV,CAAiBN,MAAjB,EAAyB,CAAzB,EAA4B,CAA5B,CAAf;AACD;;AAED,0BACE;AAAS,QAAA,GAAG,EAAE,aAAC9D,EAAD;AAAA,iBAAS,MAAI,CAACqD,UAAL,GAAkBrD,EAA3B;AAAA,SAAd;AAA8C,QAAA,QAAQ,EAAEuD;AAAxD,QADF;AAGD;;;;EAvDuBL,gB;;;;gBAApBE,W,eACe,SAAc,EAAd,EAAkB3E,iBAAlB,EAAqC;AACtD6E,EAAAA,QAAQ,EAAE3E,mBAAU0F;AADkC,CAArC,C;;gBADfjB,W,kBAIkB;AACpBvE,EAAAA,SAAS,EAAEL;AADS,C;;AAqDxB4E,WAAW,CAACD,WAAZ,GAA0B,mBAA1B;AAEA;AACA;AACA;;IACMmB,U;;;;;AAOJ,sBAAY9B,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,gCAAMA,KAAN;AACA,WAAK+B,SAAL,GAAiB,IAAjB;AAFiB;AAGlB;;;;wCAEmB;AAClB,WAAK/B,KAAL,CAAW3D,SAAX,CAAqB,KAAK0F,SAA1B;AACD;;;6BAEQ;AAAA;AAAA;;AAAA,yBACkC,KAAK/B,KADvC;AAAA,UACCpD,aADD,gBACCA,aADD;AAAA,UACgBG,KADhB,gBACgBA,KADhB;AAAA,UACuBE,MADvB,gBACuBA,MADvB;;AAAA,uBAGiBsB,QAAQ,CAC9B,SAAc,EAAd,EAAkB,KAAKyB,KAAvB,EAA8B;AAC5BG,QAAAA,IAAI,EAAE,QADsB;AAE5BrD,QAAAA,WAAW,EAAEA,WAAW,CAAC,KAAKkD,KAAN;AAFI,OAA9B,CAD8B,CAHzB;AAAA,UAGCnE,GAHD,cAGCA,GAHD;AAAA,UAGMC,MAHN,cAGMA,MAHN;;AAUP,UAAMwE,eAAe,GAAG,SACtB,EADsB,EAEtB1E,mBAFsB,EAGtB,KAAKoE,KAAL,CAAWM,eAHW,CAAxB;;AAKA,UAAMC,UAAU,GAAG,SAAc,EAAd,EAAkB,KAAKP,KAAL,CAAWzD,cAA7B,8CAChB+D,eAAe,CAACvE,KADA,EACQ,KAAKiE,KAAL,CAAWjE,KADnB,2CAEN,KAAKiE,KAAL,CAAW9D,SAFL,uCAGVa,KAAK,IAAI,CAAT,GAAa,IAAb,GAAoBA,KAHV,wCAITE,MAAM,IAAI,CAAV,GAAc,IAAd,GAAqBA,MAJZ,qCAKZ,aAACO,EAAD,EAAQ;AACX,QAAA,MAAI,CAACuE,SAAL,GAAiBvE,EAAjB;;AACA,YACE,MAAI,CAACwC,KAAL,CAAWzD,cAAX,KAA8BiE,SAA9B,IACA,SAAS,MAAI,CAACR,KAAL,CAAWzD,cAFtB,EAGE;AACAe,UAAAA,YAAY,CAAC,MAAI,CAAC0C,KAAL,CAAWzD,cAAX,CAA0BkE,GAA3B,EAAgC,MAAI,CAACsB,SAArC,CAAZ;AACD;AACF,OAbgB,cAAnB,CAfO,CA+BP;AACA;AACA;;;AACA,UAAInF,aAAJ,EAAmB;AACjB2D,QAAAA,UAAU,CAACD,eAAe,CAACxE,MAAjB,CAAV,GAAqCD,GAArC;AACD,OAFD,MAEO;AACL0E,QAAAA,UAAU,CAACD,eAAe,CAACxE,MAAjB,CAAV,aAAwCA,MAAxC;AACD,OAtCM,CAuCP;AACA;AACA;AACA;;;AAEA,0BAAO,uCAAYyE,UAAZ,CAAP;AACD;;;;EA7DsBG,gB;;;;gBAAnBoB,U,eACe,SAAc,EAAd,EAAkBrF,kCAAlB,C;;gBADfqF,U,kBAEkB;AACpBlF,EAAAA,aAAa,EAAE,KADK;AAEpBP,EAAAA,SAAS,EAAEL;AAFS,C;;AA6DxB8F,UAAU,CAACnB,WAAX,GAAyB,kBAAzB;AAEA,IAAMc,iBAAiB,GAAG,qBAAQO,8BAAR,EAAkC/B,UAAlC,CAA1B;AACA,IAAMgC,OAAO,GAAG,qBAAQD,8BAAR,EAAkCpB,WAAlC,CAAhB;;AACA,IAAMsB,MAAM,GAAG,qBAAQF,8BAAR,EAAkCF,UAAlC,CAAf;;eAEeL,iB","sourcesContent":["import \"./array-findindex\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport targetWidths from \"./targetWidths\";\nimport constructUrl from \"./constructUrl\";\nimport extractQueryParams from \"./extractQueryParams\";\nimport { ShouldComponentUpdateHOC } from \"./HOCs\";\n\nimport { compose, config } from \"./common\";\nimport { DPR_QUALITY_VALUES } from \"./constants\";\n\nconst PACKAGE_VERSION = require(\"../package.json\").version;\nconst NODE_ENV = process.env.NODE_ENV;\n\nconst buildKey = (idx) => `react-imgix-${idx}`;\n\nconst defaultImgixParams = {\n  auto: [\"format\"],\n};\n\nconst defaultAttributeMap = {\n  src: \"src\",\n  srcSet: \"srcSet\",\n  sizes: \"sizes\",\n};\n\nconst noop = () => {};\n\nconst COMMON_PROP_TYPES = {\n  className: PropTypes.string,\n  onMounted: PropTypes.func,\n  htmlAttributes: PropTypes.object,\n};\n\nconst SHARED_IMGIX_AND_SOURCE_PROP_TYPES = Object.assign(\n  {},\n  COMMON_PROP_TYPES,\n  {\n    disableQualityByDPR: PropTypes.bool,\n    disableSrcSet: PropTypes.bool,\n    disableLibraryParam: PropTypes.bool,\n    imgixParams: PropTypes.object,\n    sizes: PropTypes.string,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    src: PropTypes.string.isRequired,\n  }\n);\n\n/**\n * Validates that an aspect ratio is in the format w:h. If false is returned, the aspect ratio is in the wrong format.\n */\nfunction aspectRatioIsValid(aspectRatio) {\n  if (typeof aspectRatio !== \"string\") {\n    return false;\n  }\n\n  return /^\\d+(\\.\\d+)?:\\d+(\\.\\d+)?$/.test(aspectRatio);\n}\n\nconst setParentRef = (parentRef, el) => {\n  if (!parentRef) {\n    return;\n  }\n\n  // assign ref based on if it's a callback vs object\n  if (typeof parentRef === \"function\") {\n    parentRef(el);\n  } else {\n    parentRef.current = el;\n  }\n};\n\nconst buildSrcSetPairWithFixedHeight = (url, targetWidth, fixedHeight, _) =>\n  url + \"&h=\" + fixedHeight + \"&w=\" + targetWidth + \" \" + targetWidth + \"w\";\n\nconst buildSrcSetPairWithTargetWidth = (url, targetWidth, _1, _2) =>\n  url + \"&w=\" + targetWidth + \" \" + targetWidth + \"w\";\n\nconst buildDprSrcWithQuality = (url, quality, dpr) =>\n  url + \"&q=\" + quality + \"&dpr=\" + dpr + \" \" + dpr + \"x\";\n\nconst buildDprSrcWithoutQuality = (url, _, dpr) =>\n  url + \"&dpr=\" + dpr + \" \" + dpr + \"x\";\n\nconst buildDprSrcWithQualityByDpr = (url, quality, dpr) =>\n  url + \"&q=\" + quality + \"&dpr=\" + dpr + \" \" + dpr + \"x\";\n\n/**\n * Build a imgix source url with parameters from a raw url\n */\nfunction buildSrc({\n  src: inputSrc,\n  width,\n  height,\n  disableLibraryParam,\n  disableSrcSet,\n  imgixParams,\n  disableQualityByDPR,\n}) {\n  const fixedSize = width != null || height != null;\n\n  const [rawSrc, params] = extractQueryParams(inputSrc);\n\n  const srcOptions = Object.assign(\n    {},\n    params,\n    imgixParams,\n    disableLibraryParam ? {} : { ixlib: `react-${PACKAGE_VERSION}` },\n    fixedSize && height ? { height } : {},\n    fixedSize && width ? { width } : {}\n  );\n\n  const src = constructUrl(rawSrc, srcOptions);\n\n  let srcSet;\n\n  if (disableSrcSet) {\n    srcSet = src;\n  } else {\n    if (fixedSize) {\n      const { q, ...urlParams } = srcOptions;\n      const constructedUrl = constructUrl(rawSrc, urlParams);\n\n      let srcFn = buildDprSrcWithQualityByDpr;\n      if (q) {\n        srcFn = buildDprSrcWithQuality;\n      } else if (disableQualityByDPR) {\n        srcFn = buildDprSrcWithoutQuality;\n      }\n\n      srcSet = \"\";\n      const len = DPR_QUALITY_VALUES.length;\n      for (let i = 0; i < len; i++) {\n        const quality = DPR_QUALITY_VALUES[i];\n        srcSet += srcFn(constructedUrl, q || quality, i + 1) + \", \";\n      }\n      srcSet = srcSet.slice(0, -2);\n    } else {\n      const { width, w, height, ...urlParams } = srcOptions;\n      const constructedUrl = constructUrl(rawSrc, urlParams);\n\n      const aspectRatio = imgixParams.ar;\n      let showARWarning =\n        aspectRatio != null && aspectRatioIsValid(aspectRatio) === false;\n\n      let srcFn = buildSrcSetPairWithTargetWidth;\n      if (height) {\n        srcFn = buildSrcSetPairWithFixedHeight;\n      }\n\n      srcSet = \"\";\n      const len = targetWidths.length;\n      for (let i = 0; i < len; i++) {\n        const targetWidth = targetWidths[i];\n        srcSet += srcFn(constructedUrl, targetWidth, height) + \", \";\n      }\n      srcSet = srcSet.slice(0, -2);\n\n      if (\n        NODE_ENV !== \"production\" &&\n        showARWarning &&\n        config.warnings.invalidARFormat\n      ) {\n        console.warn(\n          `[Imgix] The aspect ratio passed (\"${aspectRatio}\") is not in the correct format. The correct format is \"W:H\".`\n        );\n      }\n    }\n  }\n\n  return {\n    src,\n    srcSet,\n  };\n}\n\n/**\n * Combines default imgix params with custom imgix params to make a imgix params config object\n */\nfunction imgixParams(props) {\n  const params = Object.assign({}, defaultImgixParams, props.imgixParams);\n  return Object.assign({}, params);\n}\n\n/**\n * React component used to render <img> elements with Imgix\n */\nclass ReactImgix extends Component {\n  static propTypes = Object.assign({}, SHARED_IMGIX_AND_SOURCE_PROP_TYPES);\n  static defaultProps = {\n    disableSrcSet: false,\n    onMounted: noop,\n  };\n\n  constructor(props) {\n    super(props);\n    this.imgRef = null;\n  }\n\n  componentDidMount() {\n    this.props.onMounted(this.imgRef);\n  }\n\n  render() {\n    const { disableSrcSet, type, width, height } = this.props;\n\n    // Pre-render checks\n    if (NODE_ENV !== \"production\" && config.warnings.sizesAttribute) {\n      if (\n        this.props.width == null &&\n        this.props.height == null &&\n        this.props.sizes == null &&\n        !this.props._inPicture\n      ) {\n        console.warn(\n          \"If width and height are not set, a sizes attribute should be passed.\"\n        );\n      }\n    }\n\n    const { src, srcSet } = buildSrc(\n      Object.assign({}, this.props, {\n        type: \"img\",\n        imgixParams: imgixParams(this.props),\n      })\n    );\n\n    const attributeConfig = Object.assign(\n      {},\n      defaultAttributeMap,\n      this.props.attributeConfig\n    );\n    const childProps = Object.assign({}, this.props.htmlAttributes, {\n      [attributeConfig.sizes]: this.props.sizes,\n      className: this.props.className,\n      width: width <= 1 ? null : width,\n      height: height <= 1 ? null : height,\n      [attributeConfig.src]: src,\n      ref: (el) => {\n        this.imgRef = el;\n        if (\n          this.props.htmlAttributes !== undefined &&\n          \"ref\" in this.props.htmlAttributes\n        ) {\n          setParentRef(this.props.htmlAttributes.ref, this.imgRef);\n        }\n      },\n    });\n    if (!disableSrcSet) {\n      childProps[attributeConfig.srcSet] = srcSet;\n    }\n\n    return <img {...childProps} />;\n  }\n}\nReactImgix.displayName = \"ReactImgix\";\n\n/**\n * React component used to render <picture> elements with Imgix\n */\nclass PictureImpl extends Component {\n  static propTypes = Object.assign({}, COMMON_PROP_TYPES, {\n    children: PropTypes.any,\n  });\n  static defaultProps = {\n    onMounted: noop,\n  };\n\n  constructor(props) {\n    super(props);\n    this.pictureRef = null;\n  }\n\n  componentDidMount() {\n    this.props.onMounted(this.pictureRef);\n  }\n\n  render() {\n    const { children } = this.props;\n\n    // make sure all of our children have key set, otherwise we get react warnings\n    let _children =\n      React.Children.map(children, (child, idx) =>\n        React.cloneElement(child, {\n          key: buildKey(idx),\n          _inPicture: true,\n        })\n      ) || [];\n\n    /*\n    We need to make sure an <img /> or <Imgix /> is the last child so we look for one in children\n      a. if we find one, move it to the last entry if it's not already there\n      b. if we don't find one, warn the user as they probably want to pass one.\n    */\n\n    // look for an <img> or <ReactImgix type='img'> - at the bare minimum we have to have a single <img> element or else it will not work.\n    let imgIdx = _children.findIndex(\n      (c) =>\n        c.type === \"img\" ||\n        c.type === ReactImgix ||\n        c.type === ReactImgixWrapped\n    );\n\n    if (imgIdx === -1 && config.warnings.fallbackImage) {\n      console.warn(\n        \"No fallback <img /> or <Imgix /> found in the children of a <picture> component. A fallback image should be passed to ensure the image renders correctly at all dimensions.\"\n      );\n    } else if (imgIdx !== _children.length - 1) {\n      // found one, need to move it to the end\n      _children.push(_children.splice(imgIdx, 1)[0]);\n    }\n\n    return (\n      <picture ref={(el) => (this.pictureRef = el)} children={_children} />\n    );\n  }\n}\nPictureImpl.displayName = \"ReactImgixPicture\";\n\n/**\n * React component used to render <source> elements with Imgix\n */\nclass SourceImpl extends Component {\n  static propTypes = Object.assign({}, SHARED_IMGIX_AND_SOURCE_PROP_TYPES);\n  static defaultProps = {\n    disableSrcSet: false,\n    onMounted: noop,\n  };\n\n  constructor(props) {\n    super(props);\n    this.sourceRef = null;\n  }\n\n  componentDidMount() {\n    this.props.onMounted(this.sourceRef);\n  }\n\n  render() {\n    const { disableSrcSet, width, height } = this.props;\n\n    const { src, srcSet } = buildSrc(\n      Object.assign({}, this.props, {\n        type: \"source\",\n        imgixParams: imgixParams(this.props),\n      })\n    );\n\n    const attributeConfig = Object.assign(\n      {},\n      defaultAttributeMap,\n      this.props.attributeConfig\n    );\n    const childProps = Object.assign({}, this.props.htmlAttributes, {\n      [attributeConfig.sizes]: this.props.sizes,\n      className: this.props.className,\n      width: width <= 1 ? null : width,\n      height: height <= 1 ? null : height,\n      ref: (el) => {\n        this.sourceRef = el;\n        if (\n          this.props.htmlAttributes !== undefined &&\n          \"ref\" in this.props.htmlAttributes\n        ) {\n          setParentRef(this.props.htmlAttributes.ref, this.sourceRef);\n        }\n      },\n    });\n\n    // inside of a <picture> element a <source> element ignores its src\n    // attribute in favor of srcSet so we set that with either an actual\n    // srcSet or a single src\n    if (disableSrcSet) {\n      childProps[attributeConfig.srcSet] = src;\n    } else {\n      childProps[attributeConfig.srcSet] = `${srcSet}`;\n    }\n    // for now we'll take media from htmlAttributes which isn't ideal because\n    //   a) this isn't an <img>\n    //   b) passing objects as props means that react will always rerender\n    //      since objects dont respond correctly to ===\n\n    return <source {...childProps} />;\n  }\n}\nSourceImpl.displayName = \"ReactImgixSource\";\n\nconst ReactImgixWrapped = compose(ShouldComponentUpdateHOC)(ReactImgix);\nconst Picture = compose(ShouldComponentUpdateHOC)(PictureImpl);\nconst Source = compose(ShouldComponentUpdateHOC)(SourceImpl);\n\nexport default ReactImgixWrapped;\nexport {\n  ReactImgix as __ReactImgixImpl, // for testing\n  Picture,\n  Source,\n  SourceImpl as __SourceImpl, // for testing\n  PictureImpl as __PictureImpl, // for testing\n};\n"],"file":"react-imgix.js"}